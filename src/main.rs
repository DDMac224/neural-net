// use clap::Parser;
use rand::distr::{Distribution, Uniform};

use crate::{ff::lin_forward, layer::Layer};

mod error;
mod ff;
mod layer;

// #[derive(Parser)]
// struct Cli {
//     #[arg(short = 'w')]
//     weights: Vec<u8>,
// }

fn main() {
    let mut rng = rand::rng();

    let mut rand_numbers = Uniform::new(-3.0, 3.0).unwrap().sample_iter(&mut rng);

    let model_dims = [784, 500, 400, 300, 100, 10];
    let mut layers: Vec<Layer<f32>> = vec![];

    for window in model_dims.windows(2) {
        let rand_data = rand_numbers.by_ref().take(window[0] * window[1]).collect();
        layers.push(Layer::new(rand_data, window[0], window[1], None).unwrap());
    }

    let input_data = [
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        0.33333333333333304,
        4.921568627450981,
        4.921568627450981,
        4.921568627450981,
        3.313725490196079,
        0.2941176470588234,
        0.17647058823529438,
        -4.372549019607844,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -2.8431372549019605,
        1.7450980392156872,
        3.862745098039216,
        4.921568627450981,
        4.921568627450981,
        4.921568627450981,
        4.921568627450981,
        4.568627450980392,
        0.21568627450980404,
        -4.568627450980392,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -4.294117647058823,
        1.7058823529411757,
        3.5882352941176467,
        4.921568627450981,
        4.921568627450981,
        4.921568627450981,
        4.921568627450981,
        2.6470588235294112,
        -1.8627450980392157,
        -4.647058823529412,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -4.098039215686274,
        -2.411764705882353,
        3.3529411764705888,
        4.921568627450981,
        4.921568627450981,
        4.921568627450981,
        4.921568627450981,
        2.764705882352941,
        -1.823529411764706,
        -4.921568627450981,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -4.0588235294117645,
        -0.5294117647058822,
        3.666666666666668,
        4.921568627450981,
        4.921568627450981,
        4.921568627450981,
        4.921568627450981,
        2.88235294117647,
        -1.941176470588235,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -3.4705882352941178,
        0.8039215686274517,
        3.980392156862745,
        4.921568627450981,
        4.921568627450981,
        4.921568627450981,
        4.80392156862745,
        2.1372549019607847,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -3.196078431372549,
        0.09803921568627416,
        2.1764705882352944,
        4.921568627450981,
        4.921568627450981,
        3.117647058823529,
        -4.921568627450981,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        4.76470588235294,
        4.921568627450981,
        4.76470588235294,
        -2.4901960784313726,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -4.372549019607844,
        -1.3529411764705883,
        4.882352941176471,
        4.921568627450981,
        2.333333333333333,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -3.235294117647059,
        2.2941176470588234,
        4.921568627450981,
        4.921568627450981,
        0.882352941176471,
        -3.9411764705882355,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -1.823529411764706,
        4.411764705882353,
        4.921568627450981,
        4.921568627450981,
        -0.33333333333333304,
        -4.019607843137255,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -3.627450980392157,
        4.450980392156863,
        3.8235294117647065,
        1.2745098039215685,
        -0.7647058823529411,
        -4.96078431372549,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -4.568627450980392,
        2.450980392156863,
        4.921568627450981,
        -2.2549019607843137,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        0.45098039215686203,
        4.921568627450981,
        2.450980392156863,
        -4.921568627450981,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -4.450980392156863,
        -4.96078431372549,
        1.0392156862745097,
        4.921568627450981,
        -1.4705882352941173,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -1.8627450980392157,
        1.1176470588235299,
        -0.8039215686274508,
        4.921568627450981,
        4.921568627450981,
        3.0392156862745097,
        -4.568627450980392,
        -5.0,
        -3.313725490196078,
        1.0392156862745097,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -4.294117647058823,
        3.5882352941176467,
        4.921568627450981,
        4.921568627450981,
        4.921568627450981,
        4.921568627450981,
        4.921568627450981,
        2.764705882352941,
        2.1372549019607847,
        4.686274509803921,
        4.450980392156863,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -3.0784313725490193,
        4.333333333333334,
        4.921568627450981,
        4.921568627450981,
        4.921568627450981,
        4.921568627450981,
        4.921568627450981,
        4.921568627450981,
        4.921568627450981,
        4.921568627450981,
        4.84313725490196,
        -1.3529411764705883,
        -1.784313725490196,
        -1.784313725490196,
        -2.803921568627451,
        -3.4705882352941178,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -3.8235294117647056,
        -3.588235294117647,
        -1.3137254901960782,
        1.0392156862745097,
        1.666666666666666,
        4.921568627450981,
        4.921568627450981,
        4.921568627450981,
        4.921568627450981,
        4.921568627450981,
        3.8235294117647065,
        1.7450980392156872,
        4.921568627450981,
        4.490196078431373,
        2.6470588235294112,
        -2.4901960784313726,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -4.882352941176471,
        -4.294117647058823,
        -4.294117647058823,
        -4.294117647058823,
        -0.0588235294117645,
        0.33333333333333304,
        1.8627450980392162,
        -3.980392156862745,
        1.5098039215686274,
        5.0,
        4.686274509803921,
        -0.019607843137254832,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
        -5.0,
    ];

    let input = Layer::new(input_data.to_vec(), 1, 784, None).unwrap();

    let output = lin_forward(input, layers).unwrap();
    println!("{:?}", output);
}
